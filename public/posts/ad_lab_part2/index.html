<!DOCTYPE html>
<html>
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Active Directory Lab with Vagrant - Part 2 &middot; </title>
        <meta name="description" content="Install the Domain Controller.
Introduction This is 2nd article of a 3 part series.
part 1: Create a Windows Server 2022 VM with vagrant. part 2: Install the Domain Controller. part 3: Add some misconfigurations, and test them with netexec. In the previous article we have created a Windows Server 2022 virtual machine using vagrant.
Now we are going to install the Domain Controller with powershell.
Current configuration If you have followed the previous article, your Vagrantfile should look like this:">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.128.2">
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" href="http://localhost:1313/dist/site.css">
        <link rel="stylesheet" href="http://localhost:1313/dist/syntax.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        
        
        
        
        

    </head>
    <body>
        
  



        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a href="http://localhost:1313/">Olivier LASNE</a>
                            </h1>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    </div>

                    <ul class="site-nav">
                        

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container">
        <header class="post-header">
    <h1 class="post-title">Active Directory Lab with Vagrant - Part 2</h1>
    
</header>

        <div class="post-content clearfix">
    

    <blockquote>
<p>Install the Domain Controller.</p>
</blockquote>
<h2 id="introduction">Introduction</h2>
<p>This is <strong>2nd article</strong> of a 3 part series.</p>
<ul>
<li>part 1: <a href="/posts/ad_lab_part1/">Create a Windows Server 2022 VM with vagrant.</a></li>
<li>part 2: <a href="https://t.ly/ptO4n">Install the Domain Controller.</a></li>
<li>part 3: <a href="https://t.ly/ptO4n">Add some misconfigurations</a>, and test them with netexec.</li>
</ul>
<p>In the <a href="/posts/ad_lab_part1/">previous article</a> we have created a <strong>Windows Server 2022</strong> virtual machine using <code>vagrant</code>.</p>
<p>Now we are going to <strong>install the <em>Domain Controller</em></strong> with <code>powershell</code>.</p>
<h2 id="current-configuration">Current configuration</h2>
<p>If you have followed the previous article, your <code>Vagrantfile</code> should look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># -*- mode: ruby -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># vi: set ft=ruby :</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Vagrant</span><span style="color:#f92672">.</span>configure(<span style="color:#e6db74">&#34;2&#34;</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>config<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Base box image</span>
</span></span><span style="display:flex;"><span>  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>box <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;StefanScherer/windows_2022&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Configure a name for the VM</span>
</span></span><span style="display:flex;"><span>  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>hostname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dc01&#34;</span>
</span></span><span style="display:flex;"><span>  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>define <span style="color:#e6db74">&#34;dc01&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Change the name in Virtualbox</span>
</span></span><span style="display:flex;"><span>  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provider <span style="color:#e6db74">&#34;virtualbox&#34;</span> <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>v<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>    v<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dc01&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Add a static IP on a Host-only network</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">IP</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.0.0.4&#34;</span>
</span></span><span style="display:flex;"><span>  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>network <span style="color:#e6db74">&#34;private_network&#34;</span>, <span style="color:#e6db74">ip</span>: <span style="color:#66d9ef">IP</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><h2 id="provisioning">Provisioning</h2>
<p>In <code>vagrant</code>, <em>provisioning</em> is the action of configuring your server.</p>
<p>We have multiple possibilites to do this:</p>
<ul>
<li>shell scripts</li>
<li>ansible</li>
<li>chef</li>
<li>etc</li>
</ul>
<h3 id="why-_powershell_-and-not-_ansible_">Why <em>powershell</em> and not <em>ansible</em></h3>
<p>I had some bad experiencies with <em>ansible</em>, some years ago, were I did write a script to apply some CIS configuration. And ended up loosing a lot of time.</p>
<p>I thank <em>ansible</em> is really awesome when you have to configure a lot of servers. But for configuring a 1 or 4 servers, I prefer to stick to a simple script.</p>
<p>It also makes things a bit easier to deploy in our case.</p>
<p>Use what makes you happy ðŸ™‚.<br>
But since a lot of AD labs are made using ansible, I thought it would be interesting to explain why we didn&rsquo;t go that way.</p>
<h3 id="okay-actual-provisioning-please-">Okay, actual provisioning please !</h3>
<p>Yep !</p>

</div>

        <footer class="post-footer clearfix"><div class="share">
    </div>
</footer>
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a href="http://localhost:1313/">Olivier LASNE</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#" aria-label="Back to Top">
                        <i class="fa fa-angle-up" aria-hidden="true"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2024 / Powered by <a href="https://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="http://localhost:1313/js/jquery-1.11.3.min.js"></script>
        <script src="http://localhost:1313/js/jquery.fitvids.js"></script>
        <script src="http://localhost:1313/js/scripts.js"></script>
        
    </body>
</html>

